function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { var callNext = step.bind(null, 'next'); var callThrow = step.bind(null, 'throw'); function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(callNext, callThrow); } } callNext(); }); }; }

// import SelectTextBetweenTags from '../lib/select-text-between-tags';

var _constantsFixturesPath = require('./constants/fixtures-path');

var _constantsFixturesPath2 = _interopRequireDefault(_constantsFixturesPath);

var _helpersSpecHelpers = require('./helpers/spec-helpers');

var _helpersSpecHelpers2 = _interopRequireDefault(_helpersSpecHelpers);

var _scriptsCreateLargeText = require('./scripts/create-large-text');

var _scriptsCreateLargeText2 = _interopRequireDefault(_scriptsCreateLargeText);

var _scriptsCreateDeepText = require('./scripts/create-deep-text');

var _scriptsCreateDeepText2 = _interopRequireDefault(_scriptsCreateDeepText);

// Use the command `window:run-package-specs` (cmd-alt-ctrl-p) to run specs.
//
// To run a specific `it` or `describe` block add an `f` to the front (e.g. `fit`
// or `fdescribe`). Remove the `f` to unfocus the block.

'use babel';describe('select-text-between-tags', function () {
  beforeEach(function () {
    atom.packages.activatePackage('select-text-between-tags');
  });

  describe('when the :select event is triggred', function () {
    var runCommand = 'select-text-between-tags:select';

    describe('it selects text between tags', function () {
      var sampleTextPath = _constantsFixturesPath2['default'].sampleTextPath;
      var selectionHello = {
        range: [[8, 39], [8, 68]],
        text: 'Hello! This is a sample file.'
      };

      // NOTE: I wanna use 'beforeAll' to avoid to call this many times,
      // but unfortunetely our Jasmine's version is probably 1.3.1.
      beforeEach(function () {
        // NOTE: It needs to be done in order to get an active text editor
        // in each spec.
        waitsForPromise(function () {
          return atom.workspace.open(sampleTextPath);
        });
      });

      // NOTE: An arrow function cannot be used, cuz it makes 'this' indicate
      // an unexpected object.
      it('does when the cursor is as <foo>ab[I]cd</foo>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 56]
        };
        var textVerificationOptions = [{ range: [[8, 54], [8, 62]], text: 'a sample' }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as <foo>[I]abcd</foo>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 39]
        };
        var textVerificationOptions = [{ range: [[8, 39], [8, 45]], text: 'Hello!' }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as <foo>abcd[I]</foo>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 68]
        };
        var textVerificationOptions = [{ range: [[8, 63], [8, 68]], text: 'file.' }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as <fo[I]o>abcd</foo>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 12]
        };
        var textVerificationOptions = [{ range: [[8, 7], [8, 22]], text: "span id='title'" }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as <foo>abcd</fo[I]o>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 72]
        };
        var textVerificationOptions = [{ range: [[8, 69], [8, 74]], text: '/span' }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as [I]<foo>abcd</foo>', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 6]
        };
        var textVerificationOptions = [{ range: [[8, 6], [8, 22]], text: "<span id='title'" }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('does when the cursor is as <foo>abcd</foo>[I]', function () {
        var stateBeforeRun = {
          cursorPosition: [8, 75]
        };
        var textVerificationOptions = [{ range: [[8, 68], [8, 75]], text: '</span>' }];
        var expectedState = {
          selection: selectionHello
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      // A canceled idea.
      xit('selects latter text when the cursor is ' + 'as <foo>abcd</foo>[I]<bar>efgh</bar>', function () {
        var stateBeforeRun = {
          cursorPosition: [9, 34]
        };
        var textVerificationOptions = [{ range: [[9, 27], [9, 34]], text: '</span>' }, { range: [[9, 34], [9, 51]], text: "<span id='right'>" }];
        var expectedState = {
          selection: {
            range: [[9, 51], [9, 57]],
            text: 'b a r'
          }
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('can selects multiline', function () {
        var stateBeforeRun = {
          cursorPosition: [11, 19]
        };
        var textVerificationOptions = [{ range: [[11, 16], [11, 20]], text: 'used' }];
        var expectedState = {
          selection: {
            range: [[10, 23], [13, 6]],
            text: '\n        This is used for tests.\n        <strong>If you edit this, the tests may break.</strong>\n      '
          }
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      it('skips empty elements like <br>', function () {
        var stateBeforeRun = {
          cursorPosition: [16, 37]
        };
        var textVerificationOptions = [{ range: [[16, 34], [16, 42]], text: 'contains' }];
        var expectedState = {
          selection: {
            range: [[16, 26], [16, 58]],
            text: 'This<br>contains<br>breaks.<br/>' }
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });

      // TODO: Implement a <li> pattern.
      xit('does when the cursor is as <li>ab[I]cd<li>efgh ' + 'about tags like <li>, which end tag can be omitted', function () {
        var stateBeforeRun = {
          cursorPosition: [18, 22]
        };
        var textVerificationOptions = [{ range: [[18, 20], [18, 23]], text: '2nd' }];
        var expectedState = {
          selection: {
            range: [[18, 20], [18, 24]],
            text: '2nd ' }
        };

        _helpersSpecHelpers2['default'].expectSelection(this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);
      });
    });

    describe('it is fast enough', function () {
      it('is when text is large', function () {
        var _this = this;

        var textPath = _constantsFixturesPath2['default'].largeTextPath;
        waitsForPromise(_asyncToGenerator(function* () {
          yield (0, _scriptsCreateLargeText2['default'])();
          yield atom.workspace.open(textPath);
        }));

        var stateBeforeRun = {
          cursorPosition: [9999, 23]
        };
        var textVerificationOptions = [{ range: [[9999, 22], [9999, 24]], text: 'is' }];
        var expectedState = {
          selection: {
            range: [[9999, 17], [9999, 34]],
            text: 'This is contents.' }
        };
        runs(function () {
          var result = _helpersSpecHelpers2['default'].expectSelection(_this, stateBeforeRun, runCommand, expectedState, textVerificationOptions);

          console.log('Performance when text is large: ' + (result.elaspedMs + 'ms'));
          // NOTE: Required speed is defined just with my feelings.
          expect(result.elaspedMs).toBeLessThan(300);
        });
      });

      it('is when text is nested deeply', function () {
        var _this2 = this;

        var textPath = _constantsFixturesPath2['default'].deepTextPath;
        waitsForPromise(_asyncToGenerator(function* () {
          yield (0, _scriptsCreateDeepText2['default'])();
          yield atom.workspace.open(textPath);
        }));

        var stateBeforeRun = {
          cursorPosition: [7003, 24]
        };
        var textVerificationOptions = [{ range: [[7003, 23], [7003, 25]], text: 'is' }];
        var expectedState = {
          selection: {
            range: [[7003, 18], [7003, 35]],
            text: 'This is contents.' }
        };
        runs(function () {
          var result = _helpersSpecHelpers2['default'].expectSelection(_this2, stateBeforeRun, runCommand, expectedState, textVerificationOptions);

          console.log('Performance when text is nested deeply: ' + (result.elaspedMs + 'ms'));
          // NOTE: Required speed is defined just with my feelings.
          expect(result.elaspedMs).toBeLessThan(300);
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2FpbW9ycmlzLy5hdG9tL3BhY2thZ2VzL3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncy9zcGVjL3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncy1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztxQ0FHeUIsMkJBQTJCOzs7O2tDQUM1Qix3QkFBd0I7Ozs7c0NBQ3BCLDZCQUE2Qjs7OztxQ0FDOUIsNEJBQTRCOzs7Ozs7Ozs7QUFOdkQsV0FBVyxDQUFDLEFBYVosUUFBUSxDQUFDLDBCQUEwQixFQUFFLFlBQU07QUFDekMsWUFBVSxDQUFDLFlBQU07QUFDZixRQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0dBQzNELENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsb0NBQW9DLEVBQUUsWUFBTTtBQUNuRCxRQUFNLFVBQVUsR0FBRyxpQ0FBaUMsQ0FBQzs7QUFFckQsWUFBUSxDQUFDLDhCQUE4QixFQUFFLFlBQU07QUFDN0MsVUFBTSxjQUFjLEdBQUcsbUNBQWEsY0FBYyxDQUFDO0FBQ25ELFVBQU0sY0FBYyxHQUFHO0FBQ3JCLGFBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3pCLFlBQUksRUFBRSwrQkFBK0I7T0FDdEMsQ0FBQzs7OztBQUlGLGdCQUFVLENBQUMsWUFBTTs7O0FBR2YsdUJBQWUsQ0FBQztpQkFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUM7U0FBQSxDQUFDLENBQUM7T0FDNUQsQ0FBQyxDQUFDOzs7O0FBSUgsUUFBRSxDQUFDLCtDQUErQyxFQUFFLFlBQVc7QUFDN0QsWUFBTSxjQUFjLEdBQUc7QUFDckIsd0JBQWMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7U0FDeEIsQ0FBQztBQUNGLFlBQU0sdUJBQXVCLEdBQUcsQ0FDOUIsRUFBQyxLQUFLLEVB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Q1QsY0FBTSxNQUFNLEdBQUcsZ0NBQVksZUFBZSxTQUNsQyxjQUFjLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFDL0MsdUJBQXVCLENBQ3hCLENBQUM7O0FBRUYsaUJBQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLElBQ3JDLE1BQU0sQ0FBQyxTQUFTLFFBQUksQ0FBQyxDQUFDOztBQUV2QyxnQkFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDNUMsQ0FBQyxDQUFDO09BQ0osQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6Ii9ob21lL2FpbW9ycmlzLy5hdG9tL3BhY2thZ2VzL3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncy9zcGVjL3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncy1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG5cbi8vIGltcG9ydCBTZWxlY3RUZXh0QmV0d2VlblRhZ3MgZnJvbSAnLi4vbGliL3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncyc7XG5pbXBvcnQgRml4dHVyZXNQYXRoIGZyb20gJy4vY29uc3RhbnRzL2ZpeHR1cmVzLXBhdGgnO1xuaW1wb3J0IFNwZWNIZWxwZXJzIGZyb20gJy4vaGVscGVycy9zcGVjLWhlbHBlcnMnO1xuaW1wb3J0IGNyZWF0ZUxhcmdlVGV4dCBmcm9tICcuL3NjcmlwdHMvY3JlYXRlLWxhcmdlLXRleHQnO1xuaW1wb3J0IGNyZWF0ZURlZXBUZXh0IGZyb20gJy4vc2NyaXB0cy9jcmVhdGUtZGVlcC10ZXh0JztcblxuLy8gVXNlIHRoZSBjb21tYW5kIGB3aW5kb3c6cnVuLXBhY2thZ2Utc3BlY3NgIChjbWQtYWx0LWN0cmwtcCkgdG8gcnVuIHNwZWNzLlxuLy9cbi8vIFRvIHJ1biBhIHNwZWNpZmljIGBpdGAgb3IgYGRlc2NyaWJlYCBibG9jayBhZGQgYW4gYGZgIHRvIHRoZSBmcm9udCAoZS5nLiBgZml0YFxuLy8gb3IgYGZkZXNjcmliZWApLiBSZW1vdmUgdGhlIGBmYCB0byB1bmZvY3VzIHRoZSBibG9jay5cblxuZGVzY3JpYmUoJ3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoJ3NlbGVjdC10ZXh0LWJldHdlZW4tdGFncycpO1xuICB9KTtcblxuICBkZXNjcmliZSgnd2hlbiB0aGUgOnNlbGVjdCBldmVudCBpcyB0cmlnZ3JlZCcsICgpID0+IHtcbiAgICBjb25zdCBydW5Db21tYW5kID0gJ3NlbGVjdC10ZXh0LWJldHdlZW4tdGFnczpzZWxlY3QnO1xuXG4gICAgZGVzY3JpYmUoJ2l0IHNlbGVjdHMgdGV4dCBiZXR3ZWVuIHRhZ3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzYW1wbGVUZXh0UGF0aCA9IEZpeHR1cmVzUGF0aC5zYW1wbGVUZXh0UGF0aDtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbkhlbGxvID0ge1xuICAgICAgICByYW5nZTogW1s4LCAzOV0sIFs4LCA2OF1dLFxuICAgICAgICB0ZXh0OiAnSGVsbG8hIFRoaXMgaXMgYSBzYW1wbGUgZmlsZS4nXG4gICAgICB9O1xuXG4gICAgICAvLyBOT1RFOiBJIHdhbm5hIHVzZSAnYmVmb3JlQWxsJyB0byBhdm9pZCB0byBjYWxsIHRoaXMgbWFueSB0aW1lcyxcbiAgICAgIC8vIGJ1dCB1bmZvcnR1bmV0ZWx5IG91ciBKYXNtaW5lJ3MgdmVyc2lvbiBpcyBwcm9iYWJseSAxLjMuMS5cbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICAvLyBOT1RFOiBJdCBuZWVkcyB0byBiZSBkb25lIGluIG9yZGVyIHRvIGdldCBhbiBhY3RpdmUgdGV4dCBlZGl0b3JcbiAgICAgICAgLy8gaW4gZWFjaCBzcGVjLlxuICAgICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gYXRvbS53b3Jrc3BhY2Uub3BlbihzYW1wbGVUZXh0UGF0aCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE5PVEU6IEFuIGFycm93IGZ1bmN0aW9uIGNhbm5vdCBiZSB1c2VkLCBjdXogaXQgbWFrZXMgJ3RoaXMnIGluZGljYXRlXG4gICAgICAvLyBhbiB1bmV4cGVjdGVkIG9iamVjdC5cbiAgICAgIGl0KCdkb2VzIHdoZW4gdGhlIGN1cnNvciBpcyBhcyA8Zm9vPmFiW0ldY2Q8L2Zvbz4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFs4LCA1Nl1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzgsIDU0XSwgWzgsIDYyXV0sIHRleHQ6ICdhIHNhbXBsZSd9XG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3RhdGUgPSB7XG4gICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25IZWxsb1xuICAgICAgICB9O1xuXG4gICAgICAgIFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICB0aGlzLCBzdGF0ZUJlZm9yZVJ1biwgcnVuQ29tbWFuZCwgZXhwZWN0ZWRTdGF0ZSxcbiAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdkb2VzIHdoZW4gdGhlIGN1cnNvciBpcyBhcyA8Zm9vPltJXWFiY2Q8L2Zvbz4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFs4LCAzOV1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzgsIDM5XSwgWzgsIDQ1XV0sIHRleHQ6ICdIZWxsbyEnfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uSGVsbG9cbiAgICAgICAgfTtcblxuICAgICAgICBTcGVjSGVscGVycy5leHBlY3RTZWxlY3Rpb24oXG4gICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnZG9lcyB3aGVuIHRoZSBjdXJzb3IgaXMgYXMgPGZvbz5hYmNkW0ldPC9mb28+JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlQmVmb3JlUnVuID0ge1xuICAgICAgICAgIGN1cnNvclBvc2l0aW9uOiBbOCwgNjhdXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHRleHRWZXJpZmljYXRpb25PcHRpb25zID0gW1xuICAgICAgICAgIHtyYW5nZTogW1s4LCA2M10sIFs4LCA2OF1dLCB0ZXh0OiAnZmlsZS4nfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uSGVsbG9cbiAgICAgICAgfTtcblxuICAgICAgICBTcGVjSGVscGVycy5leHBlY3RTZWxlY3Rpb24oXG4gICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnZG9lcyB3aGVuIHRoZSBjdXJzb3IgaXMgYXMgPGZvW0ldbz5hYmNkPC9mb28+JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlQmVmb3JlUnVuID0ge1xuICAgICAgICAgIGN1cnNvclBvc2l0aW9uOiBbOCwgMTJdXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHRleHRWZXJpZmljYXRpb25PcHRpb25zID0gW1xuICAgICAgICAgIHtyYW5nZTogW1s4LCA3XSwgWzgsIDIyXV0sIHRleHQ6IFwic3BhbiBpZD0ndGl0bGUnXCJ9XG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3RhdGUgPSB7XG4gICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25IZWxsb1xuICAgICAgICB9O1xuXG4gICAgICAgIFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICB0aGlzLCBzdGF0ZUJlZm9yZVJ1biwgcnVuQ29tbWFuZCwgZXhwZWN0ZWRTdGF0ZSxcbiAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdkb2VzIHdoZW4gdGhlIGN1cnNvciBpcyBhcyA8Zm9vPmFiY2Q8L2ZvW0ldbz4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFs4LCA3Ml1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzgsIDY5XSwgWzgsIDc0XV0sIHRleHQ6ICcvc3Bhbid9XG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3RhdGUgPSB7XG4gICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb25IZWxsb1xuICAgICAgICB9O1xuXG4gICAgICAgIFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICB0aGlzLCBzdGF0ZUJlZm9yZVJ1biwgcnVuQ29tbWFuZCwgZXhwZWN0ZWRTdGF0ZSxcbiAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdkb2VzIHdoZW4gdGhlIGN1cnNvciBpcyBhcyBbSV08Zm9vPmFiY2Q8L2Zvbz4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFs4LCA2XVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9ucyA9IFtcbiAgICAgICAgICB7cmFuZ2U6IFtbOCwgNl0sIFs4LCAyMl1dLCB0ZXh0OiBcIjxzcGFuIGlkPSd0aXRsZSdcIn1cbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRTdGF0ZSA9IHtcbiAgICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbkhlbGxvXG4gICAgICAgIH07XG5cbiAgICAgICAgU3BlY0hlbHBlcnMuZXhwZWN0U2VsZWN0aW9uKFxuICAgICAgICAgIHRoaXMsIHN0YXRlQmVmb3JlUnVuLCBydW5Db21tYW5kLCBleHBlY3RlZFN0YXRlLFxuICAgICAgICAgIHRleHRWZXJpZmljYXRpb25PcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2RvZXMgd2hlbiB0aGUgY3Vyc29yIGlzIGFzIDxmb28+YWJjZDwvZm9vPltJXScsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBzdGF0ZUJlZm9yZVJ1biA9IHtcbiAgICAgICAgICBjdXJzb3JQb3NpdGlvbjogWzgsIDc1XVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9ucyA9IFtcbiAgICAgICAgICB7cmFuZ2U6IFtbOCwgNjhdLCBbOCwgNzVdXSwgdGV4dDogJzwvc3Bhbj4nfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uSGVsbG9cbiAgICAgICAgfTtcblxuICAgICAgICBTcGVjSGVscGVycy5leHBlY3RTZWxlY3Rpb24oXG4gICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBIGNhbmNlbGVkIGlkZWEuXG4gICAgICB4aXQoJ3NlbGVjdHMgbGF0dGVyIHRleHQgd2hlbiB0aGUgY3Vyc29yIGlzICcgK1xuICAgICAgICAgICdhcyA8Zm9vPmFiY2Q8L2Zvbz5bSV08YmFyPmVmZ2g8L2Jhcj4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFs5LCAzNF1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzksIDI3XSwgWzksIDM0XV0sIHRleHQ6ICc8L3NwYW4+J30sXG4gICAgICAgICAge3JhbmdlOiBbWzksIDM0XSwgWzksIDUxXV0sIHRleHQ6IFwiPHNwYW4gaWQ9J3JpZ2h0Jz5cIn1cbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRTdGF0ZSA9IHtcbiAgICAgICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgICAgIHJhbmdlOiBbWzksIDUxXSwgWzksIDU3XV0sXG4gICAgICAgICAgICB0ZXh0OiAnYiBhIHInXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICB0aGlzLCBzdGF0ZUJlZm9yZVJ1biwgcnVuQ29tbWFuZCwgZXhwZWN0ZWRTdGF0ZSxcbiAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdjYW4gc2VsZWN0cyBtdWx0aWxpbmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVCZWZvcmVSdW4gPSB7XG4gICAgICAgICAgY3Vyc29yUG9zaXRpb246IFsxMSwgMTldXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzExLCAxNl0sIFsxMSwgMjBdXSwgdGV4dDogJ3VzZWQnfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgICAgcmFuZ2U6IFtbMTAsIDIzXSwgWzEzLCA2XV0sXG4gICAgICAgICAgICB0ZXh0OlxuYFxuICAgICAgICBUaGlzIGlzIHVzZWQgZm9yIHRlc3RzLlxuICAgICAgICA8c3Ryb25nPklmIHlvdSBlZGl0IHRoaXMsIHRoZSB0ZXN0cyBtYXkgYnJlYWsuPC9zdHJvbmc+XG4gICAgICBgXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICB0aGlzLCBzdGF0ZUJlZm9yZVJ1biwgcnVuQ29tbWFuZCwgZXhwZWN0ZWRTdGF0ZSxcbiAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSlcblxuICAgICAgaXQoJ3NraXBzIGVtcHR5IGVsZW1lbnRzIGxpa2UgPGJyPicsIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBzdGF0ZUJlZm9yZVJ1biA9IHtcbiAgICAgICAgICBjdXJzb3JQb3NpdGlvbjogWzE2LCAzN11cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9ucyA9IFtcbiAgICAgICAgICB7cmFuZ2U6IFtbMTYsIDM0XSwgWzE2LCA0Ml1dLCB0ZXh0OiAnY29udGFpbnMnfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgICAgcmFuZ2U6IFtbMTYsIDI2XSwgWzE2LCA1OF1dLFxuICAgICAgICAgICAgdGV4dDogJ1RoaXM8YnI+Y29udGFpbnM8YnI+YnJlYWtzLjxici8+J31cbiAgICAgICAgfTtcblxuICAgICAgICBTcGVjSGVscGVycy5leHBlY3RTZWxlY3Rpb24oXG4gICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0pXG5cbiAgICAgIC8vIFRPRE86IEltcGxlbWVudCBhIDxsaT4gcGF0dGVybi5cbiAgICAgIHhpdCgnZG9lcyB3aGVuIHRoZSBjdXJzb3IgaXMgYXMgPGxpPmFiW0ldY2Q8bGk+ZWZnaCAnXG4gICAgICAgICAgKyAnYWJvdXQgdGFncyBsaWtlIDxsaT4sIHdoaWNoIGVuZCB0YWcgY2FuIGJlIG9taXR0ZWQnLFxuICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBzdGF0ZUJlZm9yZVJ1biA9IHtcbiAgICAgICAgICBjdXJzb3JQb3NpdGlvbjogWzE4LCAyMl1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9ucyA9IFtcbiAgICAgICAgICB7cmFuZ2U6IFtbMTgsIDIwXSwgWzE4LCAyM11dLCB0ZXh0OiAnMm5kJ31cbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgZXhwZWN0ZWRTdGF0ZSA9IHtcbiAgICAgICAgICBzZWxlY3Rpb246IHtcbiAgICAgICAgICAgIHJhbmdlOiBbWzE4LCAyMF0sIFsxOCwgMjRdXSxcbiAgICAgICAgICAgIHRleHQ6ICcybmQgJ31cbiAgICAgICAgfTtcblxuICAgICAgICBTcGVjSGVscGVycy5leHBlY3RTZWxlY3Rpb24oXG4gICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0pXG5cbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdpdCBpcyBmYXN0IGVub3VnaCcsICgpID0+IHtcbiAgICAgIGl0KCdpcyB3aGVuIHRleHQgaXMgbGFyZ2UnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgdGV4dFBhdGggPSBGaXh0dXJlc1BhdGgubGFyZ2VUZXh0UGF0aDtcbiAgICAgICAgd2FpdHNGb3JQcm9taXNlKGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGF3YWl0IGNyZWF0ZUxhcmdlVGV4dCgpO1xuICAgICAgICAgIGF3YWl0IGF0b20ud29ya3NwYWNlLm9wZW4odGV4dFBhdGgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBzdGF0ZUJlZm9yZVJ1biA9IHtcbiAgICAgICAgICBjdXJzb3JQb3NpdGlvbjogWzk5OTksIDIzXVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRleHRWZXJpZmljYXRpb25PcHRpb25zID0gW1xuICAgICAgICAgIHtyYW5nZTogW1s5OTk5LCAyMl0sIFs5OTk5LCAyNF1dLCB0ZXh0OiAnaXMnfVxuICAgICAgICBdO1xuICAgICAgICBjb25zdCBleHBlY3RlZFN0YXRlID0ge1xuICAgICAgICAgIHNlbGVjdGlvbjoge1xuICAgICAgICAgICAgcmFuZ2U6IFtbOTk5OSwgMTddLCBbOTk5OSwgMzRdXSxcbiAgICAgICAgICAgIHRleHQ6ICdUaGlzIGlzIGNvbnRlbnRzLid9XG4gICAgICAgIH07XG4gICAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFNwZWNIZWxwZXJzLmV4cGVjdFNlbGVjdGlvbihcbiAgICAgICAgICAgIHRoaXMsIHN0YXRlQmVmb3JlUnVuLCBydW5Db21tYW5kLCBleHBlY3RlZFN0YXRlLFxuICAgICAgICAgICAgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnNcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coJ1BlcmZvcm1hbmNlIHdoZW4gdGV4dCBpcyBsYXJnZTogJ1xuICAgICAgICAgICAgICAgICAgICAgICsgYCR7cmVzdWx0LmVsYXNwZWRNc31tc2ApO1xuICAgICAgICAgIC8vIE5PVEU6IFJlcXVpcmVkIHNwZWVkIGlzIGRlZmluZWQganVzdCB3aXRoIG15IGZlZWxpbmdzLlxuICAgICAgICAgIGV4cGVjdChyZXN1bHQuZWxhc3BlZE1zKS50b0JlTGVzc1RoYW4oMzAwKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ2lzIHdoZW4gdGV4dCBpcyBuZXN0ZWQgZGVlcGx5JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHRleHRQYXRoID0gRml4dHVyZXNQYXRoLmRlZXBUZXh0UGF0aDtcbiAgICAgICAgd2FpdHNGb3JQcm9taXNlKGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGF3YWl0IGNyZWF0ZURlZXBUZXh0KCk7XG4gICAgICAgICAgYXdhaXQgYXRvbS53b3Jrc3BhY2Uub3Blbih0ZXh0UGF0aCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHN0YXRlQmVmb3JlUnVuID0ge1xuICAgICAgICAgIGN1cnNvclBvc2l0aW9uOiBbNzAwMywgMjRdXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGV4dFZlcmlmaWNhdGlvbk9wdGlvbnMgPSBbXG4gICAgICAgICAge3JhbmdlOiBbWzcwMDMsIDIzXSwgWzcwMDMsIDI1XV0sIHRleHQ6ICdpcyd9XG4gICAgICAgIF07XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU3RhdGUgPSB7XG4gICAgICAgICAgc2VsZWN0aW9uOiB7XG4gICAgICAgICAgICByYW5nZTogW1s3MDAzLCAxOF0sIFs3MDAzLCAzNV1dLFxuICAgICAgICAgICAgdGV4dDogJ1RoaXMgaXMgY29udGVudHMuJ31cbiAgICAgICAgfTtcbiAgICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gU3BlY0hlbHBlcnMuZXhwZWN0U2VsZWN0aW9uKFxuICAgICAgICAgICAgdGhpcywgc3RhdGVCZWZvcmVSdW4sIHJ1bkNvbW1hbmQsIGV4cGVjdGVkU3RhdGUsXG4gICAgICAgICAgICB0ZXh0VmVyaWZpY2F0aW9uT3B0aW9uc1xuICAgICAgICAgICk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZygnUGVyZm9ybWFuY2Ugd2hlbiB0ZXh0IGlzIG5lc3RlZCBkZWVwbHk6ICdcbiAgICAgICAgICAgICAgICAgICAgICArIGAke3Jlc3VsdC5lbGFzcGVkTXN9bXNgKTtcbiAgICAgICAgICAvLyBOT1RFOiBSZXF1aXJlZCBzcGVlZCBpcyBkZWZpbmVkIGp1c3Qgd2l0aCBteSBmZWVsaW5ncy5cbiAgICAgICAgICBleHBlY3QocmVzdWx0LmVsYXNwZWRNcykudG9CZUxlc3NUaGFuKDMwMCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=